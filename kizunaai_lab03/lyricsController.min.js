var LyricsController=function(){function t(t){this.lyricsText=null,Array.isArray(t)||(this.skip=[]),this.skip=t.slice(),this.parsedLyrics=[],this.currentLyricIndex=0,this.progress=0,this.timeouts=[]}return t.prototype.loadLyrics=function(t,r,i){var e=new XMLHttpRequest;e.open("GET",t),e.send(),e.onload=function(){if(this.lyricsText=e.responseText.split("\n").filter(function(t){return 0!=t.length}),"function"==typeof r)return r()}.bind(this),e.onerror=function(t){console.log("Cannot Load Lyrics file"),console.log(t)},e.onprogress=function(t){if("function"==typeof i)return i(t)}},t.prototype.loadLyricsFromText=function(t){this.lyricsText=t.split("\n").filter(function(t){return 0!=t.length})},t.prototype.parseLyrics=function(){if(null===this.lyricsText)return console.error("No Lyrics text");for(var t=0;t<this.lyricsText.length;t++)if(-1==this.skip.indexOf(t)){for(var r=this.lyricsText[t].match(/\[([0-9]+\:)+[0-9]+(\.[0-9]+)?\]/)[0],i=r.replace(/\[|\]/g,"").split(":"),e=[],s=0;s<i.length;s++)e.push(parseFloat(i[s]));this.parsedLyrics.push({lyric:this.lyricsText[t].replace(r,"").trim(),times:e})}},t.prototype.play=function(t,r){if(0==this.parsedLyrics.length)return console.error("No Lyrics");for(t=t||0;this.currentLyricIndex<this.parsedLyrics.length;this.currentLyricIndex++){var i=new Date(0);i.setMinutes(this.parsedLyrics[this.currentLyricIndex].times[0]),i.setMilliseconds(1e3*this.parsedLyrics[this.currentLyricIndex].times[1]+1e3*t);var e=this;this.timeouts.push(window.setTimeout(function(){"function"==typeof r&&(e.progress=e.currentLyricIndex,r(Array.prototype.slice.call(arguments)[0]))}.bind(null,e.parsedLyrics[e.currentLyricIndex]),i.getTime()))}},t.prototype.pause=function(){if(0==this.parsedLyrics.length)return console.error("No Lyrics");for(var t=this.progress+1;t<this.timeouts.length;t++)window.clearTimeout(this.timeouts[t])},t.prototype.stop=function(){if(0==this.parsedLyrics.length)return console.error("No Lyrics");this.currentLyricIndex=0,this.progress=0,this.timeouts=[]},t}();